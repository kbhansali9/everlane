<!DOCTYPE html>
<html lang="en">
<head>
	<link rel='stylesheet' href='/style/checkout.css'>

	<title>Checkout</title>

	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<link rel="stylesheet" href="/css/bootstrap.min.css">
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  	<script src="/js/bootstrap.min.js"></script>
	<script src="https://checkout.stripe.com/checkout.js"></script>
</head>
<body>
<div id="landing" class="navbar transparent navbar-inverse navbar-fixed-top">
    <nav class="navbar-inner">
      <div class="container">
      <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="true">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          </button>
        <a class="navbar-brand" href="/">Everlane</a>
        </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Men<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="/inventory">New Arrivals</a></li>
              <li><a href="/inventory">Tops</a></li>
              <li><a href="/inventory">Bottoms</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="/inventory">Accessories</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="#"><strong>SALE ITEMS!</strong></a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Women<span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="/inventory">New Arrivals</a></li>
              <li><a href="/inventory">Tops</a></li>
              <li><a href="/inventory">Bottoms</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="/inventory">Accessories</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="#"><strong>SALE ITEMS!</strong></a></li>
            </ul>
          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Cart<span class="caret"></span></a>
            <ul class="dropdown-menu">
            <% for (item of items) { %>
              
                <li><img class="img" src="<%= item.image %>" height="50" width="50">
                <h6><%= item.name %></h6>
                <h6>$<%= item.price.toFixed(2) %></h6>
                </li>
                <li role="separator" class="divider"></li>
                <li><button onclick="checkout()" class="btn btn-success navbar-right">Checkout</button></li>
            <% } %> <!--cart needs to be updated -->
            
            </ul>
          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Login<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#">Returning Customer?</a></li>
            <li><a href="#">New Customer?</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">Login via Facebook</a></li>
          </ul>
          </li>
        </ul>
        <!--<form class="navbar-form navbar-left" role="search">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
          <button type="submit" class="btn btn-default">Submit</button>
        </form>-->
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid-->
    </nav>
</div>
	<div class="container-fluid"> 
		<br>	
		<p>
		<table style="width:100%" class="table">
			<caption >
				<h2>One step away to get to your doorstep..</h2>
			</caption>
			<tr>
				<th>Item</th>
				<th>Description</th>
				<th>Price</th>
			</tr>
			<% for (item of items) { %>
				<tr>
					<td><img src="<%= item.image %>" height="50" width="50"></td>
					<td><%= item.name %></td>
					<td>$<%= item.price.toFixed(2) %></td>
				</tr>
			<% } %> 
			<tr>
				<td>Sub-total</td>
				<td></td>
				<td>$<%= subtotal.toFixed(2) %></td>
			</tr>
			<tr>
				<td>Discount</td>
				<td></td>
				<td>- $<%= discounts.toFixed(2) %></td>
			</tr>
			<tr>
				<td>Taxes</td>
				<td></td>
				<td>+ $<%= taxes.toFixed(2) %></td>
			</tr>
			<tr>
				<th>Total</th>
				<th></th>
				<th>$<%= total.toFixed(2) %></th>
			</tr>			
		</table>
		</p>
		<button type="button" class="pull-left btn btn-success">
			<a href="/inventory" id="continueShopping">Continue Shopping...</a>
		</button>
		<button type="button" class="pull-right btn btn-success" id="customButton">Purchase</button>

		<script>
			var handler = StripeCheckout.configure({
				key: 'pk_test_Hf5YzhbmfP9ns1akMPhEpDMv',
				image: 'https://d1qb2nb5cznatu.cloudfront.net/startups/i/47063-05f369b7b1527132ba05343f1b8ebb91-medium_jpg.jpg',
				locale: 'auto',
				token: function(token) {
					var data = {
						'amount': <%- total.toFixed(2) %>,
						'cart': <%- JSON.stringify(items) %>,
						'token': token
					};
					location.href = "/confirm?data=" + JSON.stringify(data);
				}
			});

			$('#customButton').on('click', function(e) {
				handler.open({
					name: 'Everlane',
					description: 'Radical Transparency',
					amount: <%- total.toFixed(2) * 100 %>
				});
			});

			$(window).on('popstate', function() {
			    handler.close();
			});
		</script>
	</div>	
</body>
</html>